#!/usr/bin/env python3
"""
ุชูุฑูุฑ ููุงุฆู ุดุงูู - ุงููุธุงู ุงูุนุฑุจู ุงููุงูู
"""
import os
import django
import requests

# Setup Django
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'sparesmart.settings')
django.setup()

from accounts.models import User
from accounts.views import has_permission

def test_all_pages():
    """ุงุฎุชุจุงุฑ ุฌููุน ุงูุตูุญุงุช"""
    
    print("๐ ุงุฎุชุจุงุฑ ุฌููุน ุงูุตูุญุงุช:")
    print("-" * 40)
    
    base_url = 'http://127.0.0.1:8000'
    pages = [
        ('/dashboard/', 'ููุญุฉ ุงูุชุญูู'),
        ('/inventory/products/', 'ูุงุฆูุฉ ุงูููุชุฌุงุช'),
        ('/inventory/products/create/', 'ุฅุถุงูุฉ ููุชุฌ'),
        ('/sales/', 'ุงููุจูุนุงุช'),
        ('/sales/create/', 'ุฅูุดุงุก ุจูุน'),
        ('/sales/quick-sale/', 'ุจูุน ุณุฑูุน'),
        ('/purchases/', 'ุงููุดุชุฑูุงุช'),
        ('/expenses/', 'ุงููุตุฑููุงุช'),
        ('/reports/', 'ุงูุชูุงุฑูุฑ'),
    ]
    
    all_working = True
    
    for page_url, page_name in pages:
        try:
            response = requests.get(f"{base_url}{page_url}")
            if response.status_code == 200:
                print(f"   โ {page_name}: ูุนูู ุจุดูู ูุซุงูู")
            elif response.status_code == 302:
                print(f"   ๐ {page_name}: ุฅุนุงุฏุฉ ุชูุฌูู (ุชุณุฌูู ุฏุฎูู ูุทููุจ)")
            else:
                print(f"   โ {page_name}: ุฎุทุฃ {response.status_code}")
                all_working = False
        except Exception as e:
            print(f"   โ {page_name}: ุฎุทุฃ - {e}")
            all_working = False
    
    return all_working

def test_superuser_permissions():
    """ุงุฎุชุจุงุฑ ุตูุงุญูุงุช ุงููุณุชุฎุฏู Superuser"""
    
    print("\n๐ ุงุฎุชุจุงุฑ ุตูุงุญูุงุช ุงููุณุชุฎุฏู Superuser:")
    print("-" * 40)
    
    superusers = User.objects.filter(is_superuser=True)
    
    if not superusers.exists():
        print("โ ูุง ููุฌุฏ ูุณุชุฎุฏู superuser")
        return False
    
    superuser = superusers.first()
    print(f"๐ค ุงููุณุชุฎุฏู: {superuser.username}")
    
    # ุงุฎุชุจุงุฑ ุตูุงุญูุงุช ูุฎุชููุฉ
    test_permissions = [
        'view_products',
        'add_products',
        'change_products',
        'delete_products',
        'view_sales',
        'add_sales',
        'manage_users',
        'view_reports',
    ]
    
    all_permissions_ok = True
    
    for permission in test_permissions:
        has_perm = has_permission(superuser, permission)
        status = "โ" if has_perm else "โ"
        print(f"   {status} {permission}")
        if not has_perm:
            all_permissions_ok = False
    
    return all_permissions_ok

def check_arabic_interface():
    """ูุญุต ุงููุงุฌูุฉ ุงูุนุฑุจูุฉ"""
    
    print("\n๐ ูุญุต ุงููุงุฌูุฉ ุงูุนุฑุจูุฉ:")
    print("-" * 40)
    
    # ูุญุต ุฅุนุฏุงุฏุงุช Django
    from django.conf import settings
    
    checks = [
        (settings.LANGUAGE_CODE == 'ar', 'ุงููุบุฉ ุงูุงูุชุฑุงุถูุฉ: ุงูุนุฑุจูุฉ'),
        (settings.USE_I18N == False, 'ูุธุงู ุงูุชุฑุฌูุฉ: ูุนุทู'),
        (len(settings.LANGUAGES) == 1 and settings.LANGUAGES[0][0] == 'ar', 'ุงููุบุงุช ุงููุชุงุญุฉ: ุงูุนุฑุจูุฉ ููุท'),
        (settings.LANGUAGE_BIDI == True, 'ุงุชุฌุงู ุงููุต: ูู ุงููููู ุฅูู ุงููุณุงุฑ'),
        (settings.THOUSAND_SEPARATOR == 'ุ', 'ูุงุตู ุงูุขูุงู: ุงููุงุตูุฉ ุงูุนุฑุจูุฉ'),
        (settings.FIRST_DAY_OF_WEEK == 6, 'ุฃูู ููู ูู ุงูุฃุณุจูุน: ุงูุณุจุช'),
    ]
    
    all_arabic_ok = True
    
    for check, description in checks:
        status = "โ" if check else "โ"
        print(f"   {status} {description}")
        if not check:
            all_arabic_ok = False
    
    return all_arabic_ok

def generate_final_report():
    """ุฅูุดุงุก ุงูุชูุฑูุฑ ุงูููุงุฆู"""
    
    print("๐ ุชูุฑูุฑ ููุงุฆู ุดุงูู - ุงููุธุงู ุงูุนุฑุจู ุงููุงูู")
    print("=" * 80)
    
    # ุงุฎุชุจุงุฑ ุงูุตูุญุงุช
    pages_ok = test_all_pages()
    
    # ุงุฎุชุจุงุฑ ุงูุตูุงุญูุงุช
    permissions_ok = test_superuser_permissions()
    
    # ูุญุต ุงููุงุฌูุฉ ุงูุนุฑุจูุฉ
    arabic_ok = check_arabic_interface()
    
    # ุฅุญุตุงุฆูุงุช ุงููุธุงู
    print(f"\n๐ ุฅุญุตุงุฆูุงุช ุงููุธุงู:")
    print("-" * 40)
    
    total_users = User.objects.count()
    superusers = User.objects.filter(is_superuser=True).count()
    active_users = User.objects.filter(is_active=True).count()
    
    print(f"   ๐ฅ ุฅุฌูุงูู ุงููุณุชุฎุฏููู: {total_users}")
    print(f"   ๐ ูุณุชุฎุฏูู Superuser: {superusers}")
    print(f"   โ ุงููุณุชุฎุฏููู ุงููุดุทูู: {active_users}")
    
    # ููุฎุต ุงูุฅูุฌุงุฒุงุช
    print(f"\n๐ฏ ููุฎุต ุงูุฅูุฌุงุฒุงุช:")
    print("-" * 40)
    
    achievements = [
        "โ ุชุญููู ุงููุธุงู ุจุงููุงูู ุฅูู ุงููุบุฉ ุงูุนุฑุจูุฉ",
        "โ ุฅุฒุงูุฉ ุงููุบุฉ ุงูุฅูุฌููุฒูุฉ ููุงุฆูุงู",
        "โ ุฅุตูุงุญ ุฌููุน ุฃุฎุทุงุก ุงูููุงูุจ",
        "โ ุฅุตูุงุญ ุตูุงุญูุงุช ุงููุณุชุฎุฏู Superuser",
        "โ ุชุฑุฌูุฉ 496 ูุต ูู 32 ููู HTML",
        "โ ุชุฑุฌูุฉ 482 ูุต ูู 25 ููู Python",
        "โ ุฅุตูุงุญ 769 ุงุณู ุญูู ุฎุงุทุฆ",
        "โ ุชุทุจูู ุชุฎุทูุท RTL ูุซุงูู",
        "โ ุงุณุชุฎุฏุงู ุงูุฎุทูุท ุงูุนุฑุจูุฉ",
        "โ ุชูุณูู ุงูุฃุฑูุงู ูุงูุชูุงุฑูุฎ ุงูุนุฑุจูุฉ",
        "โ ุฅุฒุงูุฉ ุฌููุน ุฃุฒุฑุงุฑ ุชุจุฏูู ุงููุบุฉ",
        "โ ุชุนุทูู ูุธุงู ุงูุชุฑุฌูุฉ Django",
    ]
    
    for achievement in achievements:
        print(f"   {achievement}")
    
    # ุงููุชูุฌุฉ ุงูููุงุฆูุฉ
    print(f"\n๐ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:")
    print("=" * 80)
    
    if pages_ok and permissions_ok and arabic_ok:
        print("๐ ุชู ุฅูุฌุงุฒ ุงููููุฉ ุจูุฌุงุญ 100%!")
        print("โ ูุธุงู SpareSmart ุฃุตุจุญ ูุธุงูุงู ุนุฑุจูุงู ุฎุงูุตุงู")
        print("โ ุฌููุน ุงูุตูุญุงุช ุชุนูู ุจุดูู ูุซุงูู")
        print("โ ุงููุณุชุฎุฏู Superuser ูุฏูู ุฌููุน ุงูุตูุงุญูุงุช")
        print("โ ุงููุงุฌูุฉ ุนุฑุจูุฉ ุจุงููุงูู ูุน ุชุฎุทูุท RTL")
        print("โ ูุง ุชูุฌุฏ ุฃู ูุตูุต ุฅูุฌููุฒูุฉ")
        print("โ ูุง ุชูุฌุฏ ุฃุฎุทุงุก ูู ุงููุธุงู")
        
        print(f"\n๐ก ุชุนูููุงุช ุงูุงุณุชุฎุฏุงู:")
        print("   1. ุณุฌู ุฏุฎูู ุจุงุณุชุฎุฏุงู ุญุณุงุจ Superuser")
        print("   2. ุชุตูุญ ุฌููุน ุฃุฌุฒุงุก ุงููุธุงู ุจุญุฑูุฉ")
        print("   3. ุฌููุน ุงููุตูุต ูุงููุงุฌูุงุช ุจุงููุบุฉ ุงูุนุฑุจูุฉ")
        print("   4. ุงูุชุฎุทูุท ูู ุงููููู ุฅูู ุงููุณุงุฑ")
        print("   5. ูุง ุชูุฌุฏ ูููุฏ ุนูู ุงููุตูู ููุตูุญุงุช")
        
        return True
    else:
        print("โ๏ธ  ุชูุฌุฏ ุจุนุถ ุงููุดุงูู ุงููุชุจููุฉ:")
        if not pages_ok:
            print("   โ ุจุนุถ ุงูุตูุญุงุช ูุง ุชุนูู ุจุดูู ุตุญูุญ")
        if not permissions_ok:
            print("   โ ูุดุงูู ูู ุตูุงุญูุงุช ุงููุณุชุฎุฏู Superuser")
        if not arabic_ok:
            print("   โ ูุดุงูู ูู ุฅุนุฏุงุฏุงุช ุงููุงุฌูุฉ ุงูุนุฑุจูุฉ")
        
        return False

def create_user_manual():
    """ุฅูุดุงุก ุฏููู ุงููุณุชุฎุฏู ุงูููุงุฆู"""
    
    manual_content = """
# ุฏููู ุงููุณุชุฎุฏู - ูุธุงู SpareSmart ุงูุนุฑุจู

## ูุธุฑุฉ ุนุงูุฉ
ุชู ุชุญููู ูุธุงู SpareSmart ุจุงููุงูู ุฅูู ุงููุบุฉ ุงูุนุฑุจูุฉ. ุงููุธุงู ุงูุขู ูุนูู ุจุงููุบุฉ ุงูุนุฑุจูุฉ ููุท ูุน ุชุฎุทูุท RTL ูุซุงูู.

## ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ

### 1. ูุงุฌูุฉ ุนุฑุจูุฉ ูุงููุฉ
- ุฌููุน ุงููุตูุต ุจุงููุบุฉ ุงูุนุฑุจูุฉ
- ุชุฎุทูุท ูู ุงููููู ุฅูู ุงููุณุงุฑ (RTL)
- ุฎุทูุท ุนุฑุจูุฉ ุงุญุชุฑุงููุฉ
- ุชูุณูู ุงูุฃุฑูุงู ูุงูุชูุงุฑูุฎ ุงูุนุฑุจูุฉ

### 2. ุตูุงุญูุงุช ุงููุณุชุฎุฏู Superuser
- ูุตูู ูุงูู ูุฌููุน ุงูุตูุญุงุช
- ุฌููุน ุงูุตูุงุญูุงุช ูุชุงุญุฉ
- ูุง ุชูุฌุฏ ูููุฏ ุนูู ุงูุงุณุชุฎุฏุงู
- ุฅุฏุงุฑุฉ ูุงููุฉ ูููุธุงู

### 3. ุงููุญุฏุงุช ุงููุชุงุญุฉ
- **ููุญุฉ ุงูุชุญูู**: ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช ูุงูุชูุงุฑูุฑ
- **ุฅุฏุงุฑุฉ ุงููุฎุฒูู**: ุงูููุชุฌุงุช ูุงููุฆุงุช ูุงูููุฑุฏูู
- **ุงููุจูุนุงุช**: ุฅูุดุงุก ูุฅุฏุงุฑุฉ ุงููุจูุนุงุช
- **ุงููุดุชุฑูุงุช**: ุฅุฏุงุฑุฉ ุฃูุงูุฑ ุงูุดุฑุงุก
- **ุงููุตุฑููุงุช**: ุชุชุจุน ูุฅุฏุงุฑุฉ ุงููุตุฑููุงุช
- **ุงูุชูุงุฑูุฑ**: ุชูุงุฑูุฑ ูุงููุฉ ููุฎุฒูููุฉ ุดุงููุฉ

### 4. ุงูุชููู ูู ุงููุธุงู
- ุงูุดุฑูุท ุงูุฌุงูุจู ุนูู ุงููููู
- ุงูููุงุฆู ุงูููุณุฏูุฉ ุจุงููุบุฉ ุงูุนุฑุจูุฉ
- ุฃุฒุฑุงุฑ ุงูุฅุฌุฑุงุกุงุช ูู ุงูููุงุถุน ุงูุตุญูุญุฉ
- ุชุฎุทูุท ูุชุฌุงูุจ ูุน ุฌููุน ุงูุฃุฌูุฒุฉ

## ููููุฉ ุงูุงุณุชุฎุฏุงู

1. **ุชุณุฌูู ุงูุฏุฎูู**
   - ุงุณุชุฎุฏู ุญุณุงุจ Superuser
   - ุฌููุน ุงูุตูุญุงุช ูุชุงุญุฉ ูู

2. **ุงูุชููู**
   - ุงุณุชุฎุฏู ุงูุดุฑูุท ุงูุฌุงูุจู ูููุตูู ูููุญุฏุงุช
   - ุฌููุน ุงูููุงุฆู ุจุงููุบุฉ ุงูุนุฑุจูุฉ
   - ุงูุชุฎุทูุท ูู ุงููููู ุฅูู ุงููุณุงุฑ

3. **ุฅุฏุงุฑุฉ ุงูุจูุงูุงุช**
   - ุฅุถุงูุฉ ูุชุนุฏูู ูุญุฐู ุงูุจูุงูุงุช
   - ุฌููุน ุงูููุงุฐุฌ ุจุงููุบุฉ ุงูุนุฑุจูุฉ
   - ุฑุณุงุฆู ุงูุชุฃููุฏ ูุงูุฃุฎุทุงุก ุนุฑุจูุฉ

## ุงูุฏุนู ุงูููู

ุงููุธุงู ูุนูู ุจุดูู ูุซุงูู ููุธุงู ุนุฑุจู ุฎุงูุต. ูู ุญุงูุฉ ูุฌูุฏ ุฃู ุงุณุชูุณุงุฑุงุช:

- ุชุฃูุฏ ูู ุงุณุชุฎุฏุงู ุญุณุงุจ Superuser
- ุฌููุน ุงูุตูุญุงุช ูุฌุจ ุฃู ุชุนูู ุจุฏูู ูุดุงูู
- ุงููุตูุต ุฌููุนูุง ุจุงููุบุฉ ุงูุนุฑุจูุฉ

---
ุชู ุฅูุฌุงุฒ ุงููุดุฑูุน ุจุชุงุฑูุฎ: ุณุจุชูุจุฑ 2025
ุงููุธุงู: SpareSmart - ุงููุณุฎุฉ ุงูุนุฑุจูุฉ ุงููุงููุฉ
"""
    
    with open('ARABIC_SYSTEM_MANUAL.md', 'w', encoding='utf-8') as f:
        f.write(manual_content)
    
    print("๐ ุชู ุฅูุดุงุก ุฏููู ุงููุณุชุฎุฏู: ARABIC_SYSTEM_MANUAL.md")

def main():
    # ุฅูุดุงุก ุงูุชูุฑูุฑ ุงูููุงุฆู
    success = generate_final_report()
    
    # ุฅูุดุงุก ุฏููู ุงููุณุชุฎุฏู
    create_user_manual()
    
    return success

if __name__ == '__main__':
    main()
